# Import the Certificate Generated by Certification Authority (CA)
There are different ways to generate a Certificate Signing Request (CSR), depending on whether user securing a single domain or multiple domains. Here's an overview of the two types and how you can generate them:

## **Multi-Domain CSR (SAN - Subject Alternative Name)**
- To secure multiple domains with a single SSL/TLS certificate, user will need to use SAN (Subject Alternative Name) in certificate configuration. SAN allows to include multiple domains in one certificate, which is ideal for scenarios where user needs to configure HTTPS for various subdomains or entirely different domain names. Refer to [Configuration Using SAN and DNS](#configuration-using-san-and-dns) section to know how to configure multiple domains for HTTPS.

## **Single Domain CSR**
- A Single Domain CSR is used when you want to secure just one domain with an SSL/TLS certificate. It contains only one Common Name (CN), which corresponds to the domain you want to secure. Refer to [Steps to Generate Key and CSR](#steps-to-generate-key-and-csr) section to generate the CSR file.

After generating the CSR, you need to provide the resulting file to your Certificate Authority (CA) to obtain the corresponding certificate file (.cer).

> ![Note](../assets/note.jpg)  
> If you're setting up a OpsHub Integration Manager and configuring the [connection with endpoints over mutual TLS (mTLS)](#configuration-for-the-connection-with-endpoints-over-mtls), the CA that issues your certificate must be trusted by the endpoint. Alternatively, it should be the same CA that signed the endpoint's certificate.

Once the certificate file (e.g., opshub.cer) is generated by your CA, follow the import steps provided below.

> ![Note](../assets/note.jpg)  
> If your CA delivers the certificate in .PEM format instead, refer to the [PEM Configuration](#pem-configuration) section for instructions.

## Steps to Import Certificate File

### **Dynamic parameters to update in the commands:**
- When executing the following commands, you need to replace the dynamic parameters with values specific to your setup:
  - **<OpsHub Installation Path>:** Replace this with the actual path where your OpsHub is installed. For example: `C:\Program Files\OpsHub`
  - **<myalias>:** Replace this with the alias you want to assign to the certificate. This alias helps you reference the certificate in the keystore. For example, use something like: `opshub-cert`, `root`
  - **<your-keystore-password>:** The default password for the keystore is `changeit`. If you've changed the keystore password, use the updated password. For example, if you updated the password to `newpassword`, replace it like this: `-storepass newpassword`

### **Follow these commands based on the certificate provided by your CA:**

#### **Command to import .csr file:**
- If your certificates are in Root certificates or Chain certificates, first import root certificate and then the actual certificate. Otherwise import your certificate file only.
  - Importing root certificate:  
    ```
    keytool -importcert -alias <root> -keystore <OpsHub Installation path>\AppData\OpsHubData\cacerts -trustcacerts -file <Path of your Root CER file>
    ```
  - Importing normal certificate:  
    ```
    keytool -importcert -alias <opshub.com> -keystore <OpsHub Installation Path>\AppData\OpsHubData\cacerts -file <Path of your CER file>
    ```

#### **Command to import .pem file:**
- Importing .pem file with only a certificate:
  ```
  keytool -importcert -file <certificate.pem> -keystore "<OpsHub Installation Directory>/AppData/OpsHubData/cacerts" -alias <myalias>
  ```
- Import the PKCS#12 file into a Java keystore:
  ```
  keytool -importkeystore -destkeystore "<OpsHub Installation Path>/AppData/OpsHubData/cacerts" -srckeystore <keystore.p12> -srcstoretype PKCS12 -alias <myalias>
  ```
  > ![Note](../assets/note.jpg) Replace 'keystore.p12' with the path to your PKCS#12 file.
- Import the Chain certificate using keytool:
  ```
  keytool -importcert -trustcacerts -alias <myalias> -file <chain.pem> -keystore "<OpsHub Installation Path>/AppData/OpsHubData/cacerts" -storepass <your-keystore-password>
  ```
  > ![Note](../assets/note.jpg) Here, replace chain.pem with the name of the .pem file given by the CA. If youâ€™ve changed it, use the updated password.

#### **Command to import SAN Certificate:**
```
keytool -importcert -alias <myalias> -keystore <your-keystore-location> -file <path-to-certificate-file> -storepass <your-keystore-password>
```

### **After successfully importing the certificate into the keystore, update the server.xml file to use the correct key alias.**
- The server.xml file is located at `<OpsHub Installation Path>\OpsHub Server\conf`
- Change the `keyAlias` to match the alias you used during the import process.

### **Restart the Server:**
- After making the changes, restart the server to apply the new configuration.

> ![Note](../assets/note.jpg)  
> To change and encrypt the keystore and private key passwords, refer to the section [Change Keystore and Private Key passwords](manage/advance-utilities#change-keystore-and-private-key-passwords) for instructions on how to encrypt and update the passwords in server.xml.

# Appendix

## Renew the Certificate
If certificates in the keystore have expired, you need to reimport them in the keystore. Refer to import commands in [Import the Certificate Generated by Certificate Authority](#import-the-certificate-generated-by-certification-authority-ca) section.

## Steps to Generate Key and CSR
Following are steps to import the OpsHub Integration Manager SSL certificate which is generated by third party Certificate authority (CA).

> ![Note](../assets/note.jpg)  
> Following steps can be performed once OpsHub Integration Manager installation is completed successfully with the self-signed SSL configuration.

- Stop the running OpsHub Server/OpsHub Server Service.
- Take the backup of OpsHubData folder in `<OpsHub Installation Directory>/AppData/OpsHubData`.
- Open the command prompt with administrative privileges and go to the OpsHubData directory.

The following commands should be performed in the given sequence:

```
keytool -genkeypair -keyalg RSA -alias opshub.com -keysize 2048 -keystore <OpsHub Installation Directory>\AppData\OpsHubData\cacerts
```

You will be prompted for the keystore password. The default is `changeit`.

> ![Note](../assets/note.jpg)  
> For first name and last name, it is mandatory to provide the host name of the machine where your OpsHub Integration Manager is installed.

Generate the CSR:
```
keytool -certreq -keyalg RSA -alias tomcat -file <path of new CSR file> -keystore <OpsHub Installation Path\AppData\OpsHubData\cacerts>
```

**Example:**
```
keytool -certreq -keyalg RSA -alias opshub.com -file <OpsHub Installation Dir>\OpsHub_Resources\jre\lib\security\opshub.csr -keystore <OpsHub Installation Dir>\AppData\OpsHubData\cacerts
```

## PEM Configuration
A `.pem` file is a Base64-encoded format used for cryptographic keys and certificates. It contains private keys, public keys, SSL/TLS certificates, and certificate chains.

### **Option 1: PEM with private key and certificate**
- Use the following OpenSSL commands:
  ```
  openssl rsa -in full.pem -out private-key.pem
  openssl x509 -in full.pem -out certificate.pem
  ```
- Combine them into a `.p12` file:
  ```
  openssl pkcs12 -export -in certificate.pem -inkey privatekey.pem -out keystore.p12
  ```
> ![Note](../assets/note.jpg)  
> Use this file to [import certificate](#steps-to-import-certificate-file) using `.pem` commands.

### **Option 2: PEM with only chain of certificates**
- If there's no private key, follow the instructions in [Steps to Import Certificate File](#steps-to-import-certificate-file).

## Configuration Using SAN and DNS
To generate key pair:
```
keytool -genkeypair -alias <your-alias> -keyalg RSA -keysize 2048 -dname "CN=<your-domain>, OU=<your-department>, O=<your-organization>, L=<your-city>, ST=<your-state>, C=<your-country>, emailAddress=<your-email>" -ext "SAN=dns:<your-domain>" -keypass <your-key-password> -keystore <your-keystore-location> -storepass <your-keystore-password>
```

To generate CSR:
```
keytool -certreq -keyalg RSA -alias <your-alias> -file <path-to-output-csr-file> -keystore <your-keystore-location> -ext "SAN=dns:<your-domain>"
```

## Configuration for the connection with endpoints over mTLS
- mTLS is a method of mutual authentication using digital certificates.
- OpsHub Integration Manager sends a certificate signed by a CA trusted by the endpoint or the same CA that signed the endpoint certificate.
- This certificate must be stored in the truststore at `<OpsHub Installation Directory>\AppData\OpsHubData\cacerts`.
